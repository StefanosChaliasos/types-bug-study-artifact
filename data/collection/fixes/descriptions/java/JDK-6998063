See 6460352, 6996626.   

The previous fix for 6460352 had issues that were not discovered by existing tests, and had to be reverted (6996626). 

The fix needs to be fixed and new tests provided.
