The annotation queues have a locking scheme which prevents early flushing of annotations.  However, this is not properly used in several places, the result being that type annotations are prematurely flushed under certain conditions.  This ultimately causes assertion failures.