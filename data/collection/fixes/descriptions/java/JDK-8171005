After JDK-8163190, JavaFileManager.getLocationForModule(Location location, JavaFileObject fo, String pkgName) does no longer work with location == CLASS_OUTPUT. That should be fixed.