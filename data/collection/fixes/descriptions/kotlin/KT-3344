Compilation fails with internal error for this sample:

{code:lang=kotlin}
package test

import java.util.HashMap
import java.util.ArrayList

class Foo(val attributes: Map<String, String>)

class Bar {
    val foos = ArrayList<Foo>()

    fun bar(foo: Foo) {
        foos.add(Foo(HashMap(foo.attributes))) // foo.attributes is unresolved but not marked
    }
}
{code}

When {monospace}HashMap{monospace} is replaced with {monospace}HashMap<String, String>{monospace}, compilation completes succesfully.

Exception log:
{code}
Kotlin: [Internal Error] org.jetbrains.jet.codegen.CompilationException: Back-end (JVM) Internal error: null
Cause: java.lang.AssertionError
File being compiled and position: (12,34) in test\test.kt
The root cause was thrown at: ExpressionCodegen.java:1383
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:246)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitDotQualifiedExpression(ExpressionCodegen.java:2225)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitDotQualifiedExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetDotQualifiedExpression.accept(JetDotQualifiedExpression.java:34)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:252)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:256)
	at org.jetbrains.jet.codegen.ExpressionCodegen.pushMethodArguments(ExpressionCodegen.java:2114)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1928)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1900)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1891)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateJavaConstructorCall(ExpressionCodegen.java:2936)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateConstructorCall(ExpressionCodegen.java:2882)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:1706)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:42)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:252)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:256)
	at org.jetbrains.jet.codegen.ExpressionCodegen.pushMethodArguments(ExpressionCodegen.java:2114)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1928)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1900)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1891)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateConstructorCall(ExpressionCodegen.java:2909)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:1706)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:42)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:252)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:256)
	at org.jetbrains.jet.codegen.ExpressionCodegen.pushMethodArguments(ExpressionCodegen.java:2114)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:1928)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeFunction(ExpressionCodegen.java:1785)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:1716)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:42)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitDotQualifiedExpression(ExpressionCodegen.java:2225)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitDotQualifiedExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetDotQualifiedExpression.accept(JetDotQualifiedExpression.java:34)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:252)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateBlock(ExpressionCodegen.java:1204)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitBlockExpression(ExpressionCodegen.java:1050)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitBlockExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetBlockExpression.accept(JetBlockExpression.java:47)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:218)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:252)
	at org.jetbrains.jet.codegen.ExpressionCodegen.returnExpression(ExpressionCodegen.java:1330)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethodBody(FunctionCodegen.java:204)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethodHeaderAndBody(FunctionCodegen.java:144)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethod(FunctionCodegen.java:100)
	at org.jetbrains.jet.codegen.FunctionCodegen.gen(FunctionCodegen.java:80)
	at org.jetbrains.jet.codegen.MemberCodegen.genFunctionOrProperty(MemberCodegen.java:46)
	at org.jetbrains.jet.codegen.ClassBodyCodegen.generateDeclaration(ClassBodyCodegen.java:86)
	at org.jetbrains.jet.codegen.ImplementationBodyCodegen.generateDeclaration(ImplementationBodyCodegen.java:1458)
	at org.jetbrains.jet.codegen.ClassBodyCodegen.generateClassBody(ClassBodyCodegen.java:78)
	at org.jetbrains.jet.codegen.ClassBodyCodegen.generate(ClassBodyCodegen.java:59)
	at org.jetbrains.jet.codegen.MemberCodegen.genImplementation(MemberCodegen.java:83)
	at org.jetbrains.jet.codegen.MemberCodegen.genClassOrObject(MemberCodegen.java:137)
	at org.jetbrains.jet.codegen.NamespaceCodegen.generateClassOrObject(NamespaceCodegen.java:190)
	at org.jetbrains.jet.codegen.NamespaceCodegen.generate(NamespaceCodegen.java:136)
	at org.jetbrains.jet.codegen.NamespaceCodegen.generate(NamespaceCodegen.java:98)
	at org.jetbrains.jet.codegen.KotlinCodegenFacade.generateNamespace(KotlinCodegenFacade.java:73)
	at org.jetbrains.jet.codegen.KotlinCodegenFacade.compileCorrectFiles(KotlinCodegenFacade.java:62)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.generate(KotlinToJVMBytecodeCompiler.java:361)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.analyzeAndGenerate(KotlinToJVMBytecodeCompiler.java:300)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.analyzeAndGenerate(KotlinToJVMBytecodeCompiler.java:273)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.compileModule(KotlinToJVMBytecodeCompiler.java:107)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.compileModules(KotlinToJVMBytecodeCompiler.java:128)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.java:135)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.java:52)
	at org.jetbrains.jet.cli.common.CLICompiler.exec(CLICompiler.java:114)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.exec(K2JVMCompiler.java:184)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.exec(K2JVMCompiler.java:52)
	at org.jetbrains.jet.cli.common.CLICompiler.exec(CLICompiler.java:44)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at org.jetbrains.jet.compiler.runner.CompilerRunnerUtil.invokeExecMethod(CompilerRunnerUtil.java:97)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.execInProcess(KotlinCompilerRunner.java:77)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.access$000(KotlinCompilerRunner.java:39)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner$1.fun(KotlinCompilerRunner.java:62)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner$1.fun(KotlinCompilerRunner.java:59)
	at org.jetbrains.jet.compiler.runner.CompilerRunnerUtil.outputCompilerMessagesAndHandleExitCode(CompilerRunnerUtil.java:106)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.runInProcess(KotlinCompilerRunner.java:59)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.runCompiler(KotlinCompilerRunner.java:51)
	at org.jetbrains.jet.jps.build.KotlinBuilder.build(KotlinBuilder.java:99)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runModuleLevelBuilders(IncProjectBuilder.java:963)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runBuildersForChunk(IncProjectBuilder.java:710)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildTargetsChunk(IncProjectBuilder.java:740)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildChunkIfAffected(IncProjectBuilder.java:673)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildChunks(IncProjectBuilder.java:494)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runBuild(IncProjectBuilder.java:274)
	at org.jetbrains.jps.incremental.IncProjectBuilder.build(IncProjectBuilder.java:164)
	at org.jetbrains.jps.cmdline.BuildRunner.runBuild(BuildRunner.java:122)
	at org.jetbrains.jps.cmdline.BuildSession.runBuild(BuildSession.java:205)
	at org.jetbrains.jps.cmdline.BuildSession.run(BuildSession.java:102)
	at org.jetbrains.jps.cmdline.BuildMain$MyMessageHandler$1.run(BuildMain.java:107)
	at org.jetbrains.jps.service.impl.SharedThreadPoolImpl$1.run(SharedThreadPoolImpl.java:26)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.Thread.run(Thread.java:722)
Caused by: java.lang.AssertionError
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitSimpleNameExpression(ExpressionCodegen.java:1383)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitSimpleNameExpression(ExpressionCodegen.java:76)
	at org.jetbrains.jet.lang.psi.JetSimpleNameExpression.accept(JetSimpleNameExpression.java:132)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:236)
	... 113 more
{code}