{code}
class B() : Function0<Unit> {
    override fun invoke() {}

    fun foo() {
        this() // Exception
    }

    // OK
    fun bar() {
        val t = this
        t()
        t.invoke()
    }
}
{code}

-1: -1
java.lang.ArrayIndexOutOfBoundsException: -1
	at java.util.ArrayList.get(ArrayList.java:324)
	at org.jetbrains.jet.lang.types.lang.KotlinBuiltIns.getReturnTypeFromFunctionType(KotlinBuiltIns.java:953)
	at org.jetbrains.jet.lang.descriptors.impl.FunctionDescriptorUtil.initializeFromFunctionType(FunctionDescriptorUtil.java:129)
	at org.jetbrains.jet.lang.resolve.calls.CallResolver.resolveFunctionCall(CallResolver.java:246)
	at org.jetbrains.jet.lang.resolve.calls.CallExpressionResolver.getResolvedCallForFunction(CallExpressionResolver.java:192)
	at org.jetbrains.jet.lang.resolve.calls.CallExpressionResolver.getCallExpressionTypeInfoWithoutFinalTypeCheck(CallExpressionResolver.java:304)
	at org.jetbrains.jet.lang.resolve.calls.CallExpressionResolver.getCallExpressionTypeInfo(CallExpressionResolver.java:286)
	at org.jetbrains.jet.lang.types.expressions.BasicExpressionTypingVisitor.visitCallExpression(BasicExpressionTypingVisitor.java:726)
	at org.jetbrains.jet.lang.types.expressions.BasicExpressionTypingVisitor.visitCallExpression(BasicExpressionTypingVisitor.java:74)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:59)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitJetElement(ExpressionTypingVisitorDispatcher.java:220)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitJetElement(ExpressionTypingVisitorDispatcher.java:33)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitExpression(JetVisitor.java:149)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitCallExpression(JetVisitor.java:241)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:59)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getTypeInfo(ExpressionTypingVisitorDispatcher.java:115)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getTypeInfo(ExpressionTypingVisitorDispatcher.java:85)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorForStatements.visitExpression(ExpressionTypingVisitorForStatements.java:317)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorForStatements.visitExpression(ExpressionTypingVisitorForStatements.java:51)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitCallExpression(JetVisitor.java:241)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:59)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getTypeInfo(ExpressionTypingVisitorDispatcher.java:115)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getTypeInfo(ExpressionTypingVisitorDispatcher.java:95)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.checkFunctionReturnType(ExpressionTypingServices.java:190)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.checkFunctionReturnType(ExpressionTypingServices.java:168)
	at org.jetbrains.jet.lang.resolve.BodyResolver.resolveFunctionBody(BodyResolver.java:665)
	at org.jetbrains.jet.lang.resolve.lazy.ResolveSessionUtils.functionAdditionalResolve(ResolveSessionUtils.java:299)
	at org.jetbrains.jet.lang.resolve.lazy.ResolveSessionUtils.access$100(ResolveSessionUtils.java:48)
	at org.jetbrains.jet.lang.resolve.lazy.ResolveSessionUtils$1.compute(ResolveSessionUtils.java:140)
	at org.jetbrains.jet.lang.resolve.lazy.storage.LockBasedStorageManager.compute(LockBasedStorageManager.java:114)
	at org.jetbrains.jet.lang.resolve.lazy.ResolveSessionUtils.resolveToElement(ResolveSessionUtils.java:136)
	at org.jetbrains.jet.plugin.project.CancelableResolveSession$1.compute(CancelableResolveSession.java:55)
	at org.jetbrains.jet.plugin.project.CancelableResolveSession$1.compute(CancelableResolveSession.java:52)
	at org.jetbrains.jet.plugin.project.CancelableResolveSession.computableWithProcessingCancel(CancelableResolveSession.java:138)
	at org.jetbrains.jet.plugin.project.CancelableResolveSession.resolveToElement(CancelableResolveSession.java:52)
	at org.jetbrains.jet.plugin.project.WholeProjectAnalyzerFacade.getContextForElement(WholeProjectAnalyzerFacade.java:42)
	at org.jetbrains.jet.plugin.references.JetPsiReference.doResolve(JetPsiReference.java:105)
	at org.jetbrains.jet.plugin.references.JetPsiReference.resolve(JetPsiReference.java:66)
	at com.intellij.codeInsight.TargetElementUtilBase.getReferenceOrReferencedElement(TargetElementUtilBase.java:313)
	at com.intellij.codeInsight.TargetElementUtil.getReferenceOrReferencedElement(TargetElementUtil.java:98)
	at com.intellij.codeInsight.TargetElementUtilBase.findTargetElement(TargetElementUtilBase.java:201)
	at com.intellij.codeInsight.TargetElementUtil.findTargetElement(TargetElementUtil.java:63)
	at com.intellij.codeInsight.daemon.impl.IdentifierHighlighterPass.doCollectInformation(IdentifierHighlighterPass.java:97)
	at com.intellij.codeHighlighting.TextEditorHighlightingPass.collectInformation(TextEditorHighlightingPass.java:62)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass$1$1.run(PassExecutorService.java:357)
	at com.intellij.openapi.application.impl.ApplicationImpl.tryRunReadAction(ApplicationImpl.java:1184)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass$1.run(PassExecutorService.java:348)
	at com.intellij.openapi.progress.ProgressManager.executeProcessUnderProgress(ProgressManager.java:206)
	at com.intellij.openapi.progress.impl.ProgressManagerImpl.executeProcessUnderProgress(ProgressManagerImpl.java:221)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass.doRun(PassExecutorService.java:345)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass.run(PassExecutorService.java:321)
	at com.intellij.concurrency.JobLauncherImpl$3.call(JobLauncherImpl.java:129)
	at com.intellij.concurrency.JobLauncherImpl$3.call(JobLauncherImpl.java:126)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at com.intellij.concurrency.PrioritizedFutureTask.access$101(PrioritizedFutureTask.java:31)
	at com.intellij.concurrency.PrioritizedFutureTask$1.run(PrioritizedFutureTask.java:70)
	at com.intellij.concurrency.PrioritizedFutureTask.run(PrioritizedFutureTask.java:113)
	at com.intellij.concurrency.JobImpl.scheduleAndWaitForResults(JobImpl.java:136)
	at com.intellij.concurrency.JobLauncherImpl.invokeConcurrentlyForAll(JobLauncherImpl.java:65)
	at com.intellij.concurrency.JobLauncherImpl.invokeConcurrentlyUnderProgress(JobLauncherImpl.java:93)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.getInjectedPsiFiles(GeneralHighlightingPass.java:332)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.access$800(GeneralHighlightingPass.java:84)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass$4.run(GeneralHighlightingPass.java:222)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass$11.run(GeneralHighlightingPass.java:719)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.analyzeByVisitors(GeneralHighlightingPass.java:764)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.access$3500(GeneralHighlightingPass.java:84)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass$13.run(GeneralHighlightingPass.java:770)
	at com.intellij.codeInsight.daemon.impl.DefaultHighlightVisitor.analyze(DefaultHighlightVisitor.java:87)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.analyzeByVisitors(GeneralHighlightingPass.java:767)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.access$3500(GeneralHighlightingPass.java:84)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass$13.run(GeneralHighlightingPass.java:770)
	at com.intellij.codeInsight.daemon.impl.RefCountHolder.analyze(RefCountHolder.java:298)
	at com.intellij.codeInsight.daemon.impl.analysis.HighlightVisitorImpl.analyze(HighlightVisitorImpl.java:155)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.analyzeByVisitors(GeneralHighlightingPass.java:767)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.collectHighlights(GeneralHighlightingPass.java:724)
	at com.intellij.codeInsight.daemon.impl.GeneralHighlightingPass.collectInformationWithProgress(GeneralHighlightingPass.java:215)
	at com.intellij.codeInsight.daemon.impl.ProgressableTextEditorHighlightingPass.doCollectInformation(ProgressableTextEditorHighlightingPass.java:58)
	at com.intellij.codeHighlighting.TextEditorHighlightingPass.collectInformation(TextEditorHighlightingPass.java:62)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass$1$1.run(PassExecutorService.java:357)
	at com.intellij.openapi.application.impl.ApplicationImpl.tryRunReadAction(ApplicationImpl.java:1184)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass$1.run(PassExecutorService.java:348)
	at com.intellij.openapi.progress.ProgressManager.executeProcessUnderProgress(ProgressManager.java:206)
	at com.intellij.openapi.progress.impl.ProgressManagerImpl.executeProcessUnderProgress(ProgressManagerImpl.java:221)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass.doRun(PassExecutorService.java:345)
	at com.intellij.codeInsight.daemon.impl.PassExecutorService$ScheduledPass.run(PassExecutorService.java:321)
	at com.intellij.concurrency.JobLauncherImpl$3.call(JobLauncherImpl.java:129)
	at com.intellij.concurrency.JobLauncherImpl$3.call(JobLauncherImpl.java:126)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at com.intellij.concurrency.PrioritizedFutureTask.access$101(PrioritizedFutureTask.java:31)
	at com.intellij.concurrency.PrioritizedFutureTask$1.run(PrioritizedFutureTask.java:70)
	at com.intellij.concurrency.PrioritizedFutureTask.run(PrioritizedFutureTask.java:113)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
