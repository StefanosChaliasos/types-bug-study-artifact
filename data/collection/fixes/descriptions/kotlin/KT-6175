{code}
fun <T, R:Any> foo(body: (R?) -> T): T = body(null)

fun test(): Boolean {
    return foo {
        true
    }
}
{code}

Error:(15, 16) Kotlin: [Internal Error] org.jetbrains.jet.codegen.CompilationException: Back-end (JVM) Internal error: Error types are not allowed when classBuilderMode = FULL. Type: DONT_CARE? (NullableType). Descriptor: <ERROR CLASS>. For declaration null:null in null:null
Cause: Error types are not allowed when classBuilderMode = FULL. Type: DONT_CARE? (NullableType). Descriptor: <ERROR CLASS>. For declaration null:null in null:null
File being compiled and position: (15,16) in /Users/max/Projects/JetProfile/AllTests/test/audit/SomeTest.kt
PsiElement: {
        true
    }
The root cause was thrown at: JetTypeMapper.java:258
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:259)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:223)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:265)
	at org.jetbrains.jet.codegen.CallGenerator$DefaultCallGenerator.genValueAndPut(CallGenerator.java:74)
	at org.jetbrains.jet.codegen.CallBasedArgumentGenerator.generateExpression(CallBasedArgumentGenerator.java:61)
	at org.jetbrains.jet.codegen.ArgumentGenerator.generate(ArgumentGenerator.java:47)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:2212)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeMethodWithArguments(ExpressionCodegen.java:2192)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeFunction(ExpressionCodegen.java:2112)
	at org.jetbrains.jet.codegen.ExpressionCodegen.invokeFunction(ExpressionCodegen.java:2086)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:2010)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitCallExpression(ExpressionCodegen.java:96)
	at org.jetbrains.jet.lang.psi.JetCallExpression.accept(JetCallExpression.java:35)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:242)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:223)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:265)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:269)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitReturnExpression(ExpressionCodegen.java:1635)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitReturnExpression(ExpressionCodegen.java:96)
	at org.jetbrains.jet.lang.psi.JetReturnExpression.accept(JetReturnExpression.java:30)
	at org.jetbrains.jet.codegen.CodegenStatementVisitor.visitJetElement(CodegenStatementVisitor.java:31)
	at org.jetbrains.jet.codegen.CodegenStatementVisitor.visitJetElement(CodegenStatementVisitor.java:22)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitExpression(JetVisitor.java:162)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitExpressionWithLabel(JetVisitor.java:206)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitReturnExpression(JetVisitor.java:202)
	at org.jetbrains.jet.lang.psi.JetReturnExpression.accept(JetReturnExpression.java:30)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:242)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genStatement(ExpressionCodegen.java:278)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateBlock(ExpressionCodegen.java:1470)
	at org.jetbrains.jet.codegen.ExpressionCodegen.generateBlock(ExpressionCodegen.java:1425)
	at org.jetbrains.jet.codegen.CodegenStatementVisitor.visitBlockExpression(CodegenStatementVisitor.java:51)
	at org.jetbrains.jet.codegen.CodegenStatementVisitor.visitBlockExpression(CodegenStatementVisitor.java:22)
	at org.jetbrains.jet.lang.psi.JetBlockExpression.accept(JetBlockExpression.java:44)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:242)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genStatement(ExpressionCodegen.java:278)
	at org.jetbrains.jet.codegen.ExpressionCodegen.gen(ExpressionCodegen.java:269)
	at org.jetbrains.jet.codegen.ExpressionCodegen.returnExpression(ExpressionCodegen.java:1690)
	at org.jetbrains.jet.codegen.FunctionGenerationStrategy$FunctionDefault.doGenerateBody(FunctionGenerationStrategy.java:50)
	at org.jetbrains.jet.codegen.FunctionGenerationStrategy$CodegenBased.generateBody(FunctionGenerationStrategy.java:72)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethodBody(FunctionCodegen.java:321)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethod(FunctionCodegen.java:180)
	at org.jetbrains.jet.codegen.FunctionCodegen.generateMethod(FunctionCodegen.java:121)
	at org.jetbrains.jet.codegen.FunctionCodegen.gen(FunctionCodegen.java:106)
	at org.jetbrains.jet.codegen.MemberCodegen.genFunctionOrProperty(MemberCodegen.java:122)
	at org.jetbrains.jet.codegen.PackagePartCodegen.generateBody(PackagePartCodegen.java:66)
	at org.jetbrains.jet.codegen.MemberCodegen.generate(MemberCodegen.java:92)
	at org.jetbrains.jet.codegen.PackageCodegen.generate(PackageCodegen.java:319)
	at org.jetbrains.jet.codegen.PackageCodegen.generate(PackageCodegen.java:214)
	at org.jetbrains.jet.codegen.KotlinCodegenFacade.generatePackage(KotlinCodegenFacade.java:80)
	at org.jetbrains.jet.codegen.KotlinCodegenFacade.compileCorrectFiles(KotlinCodegenFacade.java:67)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.generate(KotlinToJVMBytecodeCompiler.java:359)
	at org.jetbrains.jet.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.compileModules(KotlinToJVMBytecodeCompiler.java:136)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.java:149)
	at org.jetbrains.jet.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.java:51)
	at org.jetbrains.jet.cli.common.CLICompiler.exec(CLICompiler.java:142)
	at org.jetbrains.jet.cli.common.CLICompiler.exec(CLICompiler.java:128)
	at org.jetbrains.jet.cli.common.CLICompiler.execAndOutputHtml(CLICompiler.java:58)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:601)
	at org.jetbrains.jet.compiler.runner.CompilerRunnerUtil.invokeExecMethod(CompilerRunnerUtil.java:133)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.execCompiler(KotlinCompilerRunner.java:111)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.access$000(KotlinCompilerRunner.java:39)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner$1.fun(KotlinCompilerRunner.java:94)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner$1.fun(KotlinCompilerRunner.java:91)
	at org.jetbrains.jet.compiler.runner.CompilerRunnerUtil.outputCompilerMessagesAndHandleExitCode(CompilerRunnerUtil.java:142)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.runCompiler(KotlinCompilerRunner.java:91)
	at org.jetbrains.jet.compiler.runner.KotlinCompilerRunner.runK2JvmCompiler(KotlinCompilerRunner.java:57)
	at org.jetbrains.jet.jps.build.KotlinBuilder.build(KotlinBuilder.kt:199)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runModuleLevelBuilders(IncProjectBuilder.java:1140)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runBuildersForChunk(IncProjectBuilder.java:826)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildTargetsChunk(IncProjectBuilder.java:894)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildChunkIfAffected(IncProjectBuilder.java:789)
	at org.jetbrains.jps.incremental.IncProjectBuilder.buildChunks(IncProjectBuilder.java:612)
	at org.jetbrains.jps.incremental.IncProjectBuilder.runBuild(IncProjectBuilder.java:352)
	at org.jetbrains.jps.incremental.IncProjectBuilder.build(IncProjectBuilder.java:191)
	at org.jetbrains.jps.cmdline.BuildRunner.runBuild(BuildRunner.java:131)
	at org.jetbrains.jps.cmdline.BuildSession.runBuild(BuildSession.java:229)
	at org.jetbrains.jps.cmdline.BuildSession.run(BuildSession.java:113)
	at org.jetbrains.jps.cmdline.BuildMain$MyMessageHandler$1.run(BuildMain.java:158)
	at org.jetbrains.jps.service.impl.SharedThreadPoolImpl$1.run(SharedThreadPoolImpl.java:41)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
	at java.lang.Thread.run(Thread.java:722)
Caused by: java.lang.IllegalStateException: Error types are not allowed when classBuilderMode = FULL. Type: DONT_CARE? (NullableType). Descriptor: <ERROR CLASS>. For declaration null:null in null:null
	at org.jetbrains.jet.codegen.state.JetTypeMapper.mapType(JetTypeMapper.java:258)
	at org.jetbrains.jet.codegen.state.JetTypeMapper.mapType(JetTypeMapper.java:208)
	at org.jetbrains.jet.codegen.state.JetTypeMapper.writeGenericType(JetTypeMapper.java:391)
	at org.jetbrains.jet.codegen.state.JetTypeMapper.mapType(JetTypeMapper.java:285)
	at org.jetbrains.jet.codegen.state.JetTypeMapper.mapType(JetTypeMapper.java:208)
	at org.jetbrains.jet.codegen.state.JetTypeMapper.mapSupertype(JetTypeMapper.java:182)
	at org.jetbrains.jet.codegen.ClosureCodegen.gen(ClosureCodegen.java:146)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genClosure(ExpressionCodegen.java:1334)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitFunctionLiteralExpression(ExpressionCodegen.java:1317)
	at org.jetbrains.jet.codegen.ExpressionCodegen.visitFunctionLiteralExpression(ExpressionCodegen.java:96)
	at org.jetbrains.jet.lang.psi.JetFunctionLiteralExpression.accept(JetFunctionLiteralExpression.java:34)
	at org.jetbrains.jet.codegen.ExpressionCodegen.genQualified(ExpressionCodegen.java:242)
	... 87 more