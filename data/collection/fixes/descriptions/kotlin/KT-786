{code}
fun foo() : Int {
    val d = 2
    var z = 0
    when(d) {
        is 5, is 3 => z++
        else => { z = -1000
    }
    return z
}
{code}

java.lang.UnsupportedOperationException: Don't enumerate supertypes of Nothing
	at org.jetbrains.jet.lang.types.JetStandardClasses$1.iterator(JetStandardClasses.java:42)
	at java.util.Collections$UnmodifiableCollection$1.<init>(Collections.java:1007)
	at java.util.Collections$UnmodifiableCollection.iterator(Collections.java:1006)
	at org.jetbrains.jet.lang.types.TypeUtils.fillInDeepSubstitutor(TypeUtils.java:364)
	at org.jetbrains.jet.lang.types.TypeUtils.buildDeepSubstitutionMultimap(TypeUtils.java:339)
	at org.jetbrains.jet.lang.types.expressions.BasicExpressionTypingVisitor.isCastErased(BasicExpressionTypingVisitor.java:261)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor$2.checkTypeCompatibility(PatternMatchingTypingVisitor.java:249)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor$2.visitExpressionPattern(PatternMatchingTypingVisitor.java:207)
	at org.jetbrains.jet.lang.psi.JetExpressionPattern.accept(JetExpressionPattern.java:22)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor.checkPatternType(PatternMatchingTypingVisitor.java:144)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor.access$000(PatternMatchingTypingVisitor.java:30)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor$1.visitWhenConditionIsPattern(PatternMatchingTypingVisitor.java:129)
	at org.jetbrains.jet.lang.psi.JetWhenConditionIsPattern.accept(JetWhenConditionIsPattern.java:27)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor.checkWhenCondition(PatternMatchingTypingVisitor.java:114)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor.visitWhenExpression(PatternMatchingTypingVisitor.java:71)
	at org.jetbrains.jet.lang.types.expressions.PatternMatchingTypingVisitor.visitWhenExpression(PatternMatchingTypingVisitor.java:30)
	at org.jetbrains.jet.lang.psi.JetWhenExpression.accept(JetWhenExpression.java:35)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitWhenExpression(ExpressionTypingVisitorDispatcher.java:194)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitWhenExpression(ExpressionTypingVisitorDispatcher.java:21)
	at org.jetbrains.jet.lang.psi.JetWhenExpression.accept(JetWhenExpression.java:35)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getType(ExpressionTypingVisitorDispatcher.java:100)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getType(ExpressionTypingVisitorDispatcher.java:84)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorForStatements.visitExpression(ExpressionTypingVisitorForStatements.java:254)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorForStatements.visitExpression(ExpressionTypingVisitorForStatements.java:32)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitWhenExpression(JetVisitor.java:200)
	at org.jetbrains.jet.lang.psi.JetWhenExpression.accept(JetWhenExpression.java:35)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getType(ExpressionTypingVisitorDispatcher.java:100)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getTypeForStatement(ExpressionTypingVisitorDispatcher.java:90)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.getBlockReturnedTypeWithWritableScope(ExpressionTypingServices.java:252)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.getBlockReturnedType(ExpressionTypingServices.java:150)
	at org.jetbrains.jet.lang.types.expressions.BasicExpressionTypingVisitor.visitBlockExpression(BasicExpressionTypingVisitor.java:482)
	at org.jetbrains.jet.lang.types.expressions.BasicExpressionTypingVisitor.visitBlockExpression(BasicExpressionTypingVisitor.java:41)
	at org.jetbrains.jet.lang.psi.JetBlockExpression.accept(JetBlockExpression.java:24)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitJetElement(ExpressionTypingVisitorDispatcher.java:201)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.visitJetElement(ExpressionTypingVisitorDispatcher.java:21)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitExpression(JetVisitor.java:132)
	at org.jetbrains.jet.lang.psi.JetVisitor.visitBlockExpression(JetVisitor.java:264)
	at org.jetbrains.jet.lang.psi.JetBlockExpression.accept(JetBlockExpression.java:24)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getType(ExpressionTypingVisitorDispatcher.java:100)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingVisitorDispatcher.getType(ExpressionTypingVisitorDispatcher.java:84)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.checkFunctionReturnType(ExpressionTypingServices.java:136)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.checkFunctionReturnType(ExpressionTypingServices.java:113)
	at org.jetbrains.jet.lang.types.expressions.ExpressionTypingServices.checkFunctionReturnType(ExpressionTypingServices.java:94)
	at org.jetbrains.jet.lang.resolve.BodyResolver.resolveFunctionBody(BodyResolver.java:499)
	at org.jetbrains.jet.lang.resolve.BodyResolver.resolveFunctionBodies(BodyResolver.java:481)
	at org.jetbrains.jet.lang.resolve.BodyResolver.resolveBehaviorDeclarationBodies(BodyResolver.java:55)
	at org.jetbrains.jet.lang.resolve.TopDownAnalyzer.doProcess(TopDownAnalyzer.java:71)
	at org.jetbrains.jet.lang.resolve.TopDownAnalyzer.process(TopDownAnalyzer.java:51)
	at org.jetbrains.jet.lang.resolve.TopDownAnalyzer.process(TopDownAnalyzer.java:37)
	at org.jetbrains.jet.lang.resolve.AnalyzingUtils.analyzeNamespacesWithGivenTrace(AnalyzingUtils.java:99)
	at org.jetbrains.jet.lang.resolve.java.AnalyzerFacade.analyzeNamespacesWithJavaIntegration(AnalyzerFacade.java:83)
	at org.jetbrains.jet.lang.resolve.java.AnalyzerFacade$2.compute(AnalyzerFacade.java:54)
	at com.intellij.psi.impl.PsiCachedValueImpl.doCompute(PsiCachedValueImpl.java:47)
	at com.intellij.util.CachedValueBase.getValueWithLock(CachedValueBase.java:200)
	at com.intellij.psi.impl.PsiCachedValueImpl.getValue(PsiCachedValueImpl.java:37)
	at org.jetbrains.jet.lang.resolve.java.AnalyzerFacade.analyzeFileWithCache(AnalyzerFacade.java:74)
	at org.jetbrains.jet.plugin.compiler.WholeProjectAnalyzerFacade.analyzeProjectWithCacheOnAFile(WholeProjectAnalyzerFacade.java:71)
	at org.jetbrains.jet.plugin.annotations.JetPsiChecker.annotate(JetPsiChecker.java:58)