Typer craches with a *tail of empty list* on nested `Tuple2K` patterns:

```scala
case class Tuple2K[X, A[_], B[_]](a: A[X], b: B[X])

object Test {
  def f[X](x: Tuple2K[X, Option, [Y] => Tuple2K[Y, Option, Option]]): Any =
    x match {
      case Tuple2K(_, Tuple2K(_, _)) => ???
    }
}
```

<details>
  <summary>
    Full stack trace
  </summary>
  <pre>
Exception in thread "main" java.lang.UnsupportedOperationException: tail of empty list
        at scala.collection.immutable.Nil$.tail(List.scala:430)
        at scala.collection.immutable.Nil$.tail(List.scala:425)
        at dotty.tools.dotc.core.Substituters.subst(Substituters.scala:64)
        at dotty.tools.dotc.core.Substituters.subst$(Substituters.scala:55)
        at dotty.tools.dotc.core.Contexts$Context.subst(Contexts.scala:57)
        at dotty.tools.dotc.core.Substituters$SubstMap.apply(Substituters.scala:213)
        at dotty.tools.dotc.core.Types$TypeMap.mapOver(Types.scala:3858)
        at dotty.tools.dotc.core.Substituters.subst(Substituters.scala:72)
        at dotty.tools.dotc.core.Substituters.subst$(Substituters.scala:55)
        at dotty.tools.dotc.core.Contexts$Context.subst(Contexts.scala:57)
        at dotty.tools.dotc.core.Types$Type.subst(Types.scala:1269)
        at dotty.tools.dotc.core.Types$LambdaType.integrate(Types.scala:2590)
        at dotty.tools.dotc.core.Types$LambdaType.integrate$(Types.scala:2584)
        at dotty.tools.dotc.core.Types$HKLambda.integrate(Types.scala:2608)
        at dotty.tools.dotc.core.TypeComparer.$anonfun$liftIfHK$5(TypeComparer.scala:1442)
        at scala.runtime.Tuple2Zipped$.$anonfun$map$1(Tuple2Zipped.scala:47)
        at scala.collection.immutable.List.foreach(List.scala:389)
        at scala.runtime.Tuple2Zipped$.map$extension(Tuple2Zipped.scala:45)
        at dotty.tools.dotc.core.TypeComparer.$anonfun$liftIfHK$4(TypeComparer.scala:1440)
        at dotty.tools.dotc.core.Types$HKTypeLambda.<init>(Types.scala:2928)
        at dotty.tools.dotc.core.Types$HKTypeLambda$.apply(Types.scala:2980)
        at dotty.tools.dotc.core.TypeComparer.liftIfHK(TypeComparer.scala:1439)
        at dotty.tools.dotc.core.TypeComparer.orType(TypeComparer.scala:1418)
        at dotty.tools.dotc.core.TypeComparer.$anonfun$lub$2(TypeComparer.scala:1244)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.core.TypeComparer.lub(TypeComparer.scala:1228)
        at dotty.tools.dotc.core.Types$Type.$anonfun$$bar$1(Types.scala:870)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.core.Types$Type.$bar(Types.scala:870)
        at dotty.tools.dotc.core.ConstraintHandling.narrowedBound(ConstraintHandling.scala:84)
        at dotty.tools.dotc.core.ConstraintHandling.narrowedBound$(ConstraintHandling.scala:78)
        at dotty.tools.dotc.core.TypeComparer.narrowedBound(TypeComparer.scala:19)
        at dotty.tools.dotc.core.ConstraintHandling.addOneBound(ConstraintHandling.scala:65)
        at dotty.tools.dotc.core.ConstraintHandling.addLowerBound(ConstraintHandling.scala:109)
        at dotty.tools.dotc.core.ConstraintHandling.addLowerBound$(ConstraintHandling.scala:104)
        at dotty.tools.dotc.core.TypeComparer.addLowerBound(TypeComparer.scala:19)
        at dotty.tools.dotc.core.ConstraintHandling.addConstraint(ConstraintHandling.scala:458)
        at dotty.tools.dotc.core.ConstraintHandling.addConstraint$(ConstraintHandling.scala:354)
        at dotty.tools.dotc.core.TypeComparer.addConstraint(TypeComparer.scala:19)
        at dotty.tools.dotc.core.ConstraintHandling.tryInstantiate(ConstraintHandling.scala:468)
        at dotty.tools.dotc.core.ConstraintHandling.tryInstantiate$(ConstraintHandling.scala:465)
        at dotty.tools.dotc.core.TypeComparer.tryInstantiate(TypeComparer.scala:19)
        at dotty.tools.dotc.core.TypeComparer.isMatchingApply$1(TypeComparer.scala:662)
        at dotty.tools.dotc.core.TypeComparer.compareAppliedType2(TypeComparer.scala:773)
        at dotty.tools.dotc.core.TypeComparer.thirdTry(TypeComparer.scala:386)
        at dotty.tools.dotc.core.TypeComparer.secondTry(TypeComparer.scala:353)
        at dotty.tools.dotc.core.TypeComparer.firstTry(TypeComparer.scala:277)
        at dotty.tools.dotc.core.TypeComparer.$anonfun$isSubType$2(TypeComparer.scala:118)
        at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:12)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:28)
        at dotty.tools.dotc.core.TypeComparer.isSubType(TypeComparer.scala:109)
        at dotty.tools.dotc.core.TypeComparer.compareAppliedType1(TypeComparer.scala:810)
        at dotty.tools.dotc.core.TypeComparer.fourthTry(TypeComparer.scala:582)
        at dotty.tools.dotc.core.TypeComparer.compareAppliedType2(TypeComparer.scala:780)
        at dotty.tools.dotc.core.TypeComparer.thirdTry(TypeComparer.scala:386)
        at dotty.tools.dotc.core.TypeComparer.secondTry(TypeComparer.scala:353)
        at dotty.tools.dotc.core.TypeComparer.firstTry(TypeComparer.scala:277)
        at dotty.tools.dotc.core.TypeComparer.$anonfun$isSubType$2(TypeComparer.scala:118)
        at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:12)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:28)
        at dotty.tools.dotc.core.TypeComparer.isSubType(TypeComparer.scala:109)
        at dotty.tools.dotc.core.TypeComparer.topLevelSubType(TypeComparer.scala:103)
        at dotty.tools.dotc.core.Types$Type.$anonfun$$less$colon$less$1(Types.scala:752)
        at scala.runtime.java8.JFunction0$mcZ$sp.apply(JFunction0$mcZ$sp.java:12)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.core.Types$Type.$less$colon$less(Types.scala:752)
        at dotty.tools.dotc.typer.Applications.$anonfun$typedUnApply$1(Applications.scala:920)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Applications.typedUnApply(Applications.scala:829)
        at dotty.tools.dotc.typer.Applications.typedUnApply$(Applications.scala:829)
        at dotty.tools.dotc.typer.Typer.typedUnApply(Typer.scala:69)
        at dotty.tools.dotc.typer.Typer.typedUnnamed$1(Typer.scala:1632)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1679)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Applications.$anonfun$typedUnApply$25(Applications.scala:976)
        at scala.runtime.Tuple2Zipped$.$anonfun$map$1(Tuple2Zipped.scala:47)
        at scala.collection.immutable.List.foreach(List.scala:389)
        at scala.runtime.Tuple2Zipped$.map$extension(Tuple2Zipped.scala:45)
        at dotty.tools.dotc.typer.Applications.$anonfun$typedUnApply$1(Applications.scala:976)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Applications.typedUnApply(Applications.scala:829)
        at dotty.tools.dotc.typer.Applications.typedUnApply$(Applications.scala:829)
        at dotty.tools.dotc.typer.Typer.typedUnApply(Typer.scala:69)
        at dotty.tools.dotc.typer.Typer.typedUnnamed$1(Typer.scala:1632)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1679)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Typer.typedPattern(Typer.scala:1757)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedCase$1(Typer.scala:966)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Typer.typedCase(Typer.scala:924)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedCases$3(Typer.scala:918)
        at dotty.tools.dotc.core.Decorators$ListDecorator$.loop$1(Decorators.scala:62)
        at dotty.tools.dotc.core.Decorators$ListDecorator$.mapconserve$extension(Decorators.scala:78)
        at dotty.tools.dotc.typer.Typer.typedCases(Typer.scala:918)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedMatch$3(Typer.scala:890)
        at dotty.tools.dotc.typer.Applications.harmonic(Applications.scala:1514)
        at dotty.tools.dotc.typer.Applications.harmonic$(Applications.scala:1512)
        at dotty.tools.dotc.typer.Typer.harmonic(Typer.scala:69)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedMatch$1(Typer.scala:890)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Typer.typedMatch(Typer.scala:881)
        at dotty.tools.dotc.typer.Typer.typedUnnamed$1(Typer.scala:1644)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1679)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Typer.typedExpr(Typer.scala:1753)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedDefDef$1(Typer.scala:1309)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Typer.typedDefDef(Typer.scala:1291)
        at dotty.tools.dotc.typer.Typer.typedNamed$1(Typer.scala:1620)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1678)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Typer.traverse$1(Typer.scala:1718)
        at dotty.tools.dotc.typer.Typer.typedStats(Typer.scala:1741)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedClassDef$1(Typer.scala:1409)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Typer.typedClassDef(Typer.scala:1339)
        at dotty.tools.dotc.typer.Typer.typedNamed$1(Typer.scala:1623)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1678)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Typer.traverse$1(Typer.scala:1718)
        at dotty.tools.dotc.typer.Typer.typedStats(Typer.scala:1741)
        at dotty.tools.dotc.typer.Typer.$anonfun$typedPackageDef$1(Typer.scala:1522)
        at dotty.tools.dotc.util.Stats$.track(Stats.scala:35)
        at dotty.tools.dotc.typer.Typer.typedPackageDef(Typer.scala:1509)
        at dotty.tools.dotc.typer.Typer.typedUnnamed$1(Typer.scala:1662)
        at dotty.tools.dotc.typer.Typer.typedUnadapted(Typer.scala:1679)
        at dotty.tools.dotc.typer.Typer.$anonfun$typed$2(Typer.scala:1696)
        at dotty.tools.dotc.reporting.trace$.apply(trace.scala:23)
        at dotty.tools.dotc.typer.Typer.typed(Typer.scala:1692)
        at dotty.tools.dotc.typer.Typer.typedExpr(Typer.scala:1753)
        at dotty.tools.dotc.typer.FrontEnd.$anonfun$typeCheck$1(FrontEnd.scala:64)
        at dotty.tools.dotc.typer.FrontEnd.monitor(FrontEnd.scala:32)
        at dotty.tools.dotc.typer.FrontEnd.typeCheck(FrontEnd.scala:62)
        at dotty.tools.dotc.typer.FrontEnd.$anonfun$runOn$7(FrontEnd.scala:93)
        at dotty.tools.dotc.typer.FrontEnd.$anonfun$runOn$7$adapted(FrontEnd.scala:93)
        at scala.collection.immutable.List.foreach(List.scala:389)
        at dotty.tools.dotc.typer.FrontEnd.runOn(FrontEnd.scala:93)
        at dotty.tools.dotc.Run.$anonfun$compileUnits$3(Run.scala:124)
        at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:12)
        at dotty.tools.dotc.util.Stats$.trackTime(Stats.scala:47)
        at dotty.tools.dotc.Run.$anonfun$compileUnits$2(Run.scala:122)
        at dotty.tools.dotc.Run.$anonfun$compileUnits$2$adapted(Run.scala:120)
        at scala.collection.IndexedSeqOptimized.foreach(IndexedSeqOptimized.scala:32)
        at scala.collection.IndexedSeqOptimized.foreach$(IndexedSeqOptimized.scala:29)
        at scala.collection.mutable.ArrayOps$ofRef.foreach(ArrayOps.scala:191)
        at dotty.tools.dotc.Run.$anonfun$compileUnits$1(Run.scala:120)
        at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:12)
        at dotty.tools.dotc.util.Stats$.maybeMonitored(Stats.scala:86)
        at dotty.tools.dotc.Run.compileUnits(Run.scala:108)
        at dotty.tools.dotc.Run.compileSources(Run.scala:95)
        at dotty.tools.dotc.Run.compile(Run.scala:79)
        at dotty.tools.dotc.Driver.doCompile(Driver.scala:26)
        at dotty.tools.dotc.Driver.process(Driver.scala:124)
        at dotty.tools.dotc.Driver.process(Driver.scala:93)
        at dotty.tools.dotc.Driver.process(Driver.scala:105)
        at dotty.tools.dotc.Driver.main(Driver.scala:132)
        at dotty.tools.dotc.Main.main(Main.scala)
  </pre>
</details>
